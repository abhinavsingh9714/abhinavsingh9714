@tailwind base;
@tailwind components;
@tailwind utilities;

/* Typography — values injected by next/font via layout.tsx CSS variables */
:root {
  --font-heading: var(--font-instrument-serif), 'Georgia', serif;
  --font-sans:    var(--font-inter),            system-ui, -apple-system, sans-serif;
  --font-mono:    var(--font-jetbrains-mono),   ui-monospace, 'SF Mono', monospace;
}

/* Motion: opacity + transform only; 120–200ms per spec */
:root {
  --motion-enter: 180ms;
  --motion-press: 75ms;
  --ease: ease-in-out;
  --ease-decel: cubic-bezier(0, 0, 0.2, 1);
}

@media (prefers-reduced-motion: reduce) {
  :root {
    --motion-enter: 0ms;
    --motion-press: 0ms;
  }
}

/* ─── Shell layout variables ─────────────────────────────────────────────── */
:root {
  --header-h:         56px;   /* fixed header height — single source of truth   */
  --col-left:         20%;    /* left sidebar width                              */
  --col-center:       55%;    /* center chat column width                        */
  --col-right:        25%;    /* right context panel width                       */
  --col-left-min:     200px;
  --col-right-min:    220px;
  --breakpoint-collapse: 900px; /* left sidebar hides below this width           */
}

/* ─── Design tokens — light ──────────────────────────────────────────────── */
:root {
  --bg:           #FBFAF8;
  --workspace:    #FFFFFF;
  --surface:      #FFFFFF;
  --surface-2:    #F5F3EF;
  --surface-3:    #EDEAE4;
  --border:       #E7E5E4;
  --border-subtle:#F0EDE8;
  --text:         #0F172A;
  --text-muted:   #475569;
  --text-subtle:  #64748B;
  --primary:      #4F46E5;
  --primary-weak: #E0E7FF;
  --accent:       #c0724a;
  --accent-weak:  #faeee6;
  --success:      #16A34A;
  --error:        #DC2626;

  --radius-sm:   10px;
  --radius-md:   14px;
  --radius-lg:   18px;
  --radius-pill: 9999px;
  --r-sm: var(--radius-sm);
  --r-md: var(--radius-md);
  --r-lg: var(--radius-lg);

  --space-1: 4px;
  --space-2: 8px;
  --space-4: 16px;
  --space-6: 24px;

  --fs-xs:    12px;
  --fs-sm:    14px;
  --fs-base:  16px;
  --fs-title: 18px;
  --fs-h1:    24px;
}

/* ─── Design tokens — Warm Dark ("Mission Control") ────────────────────────
   Activated by the .dark class on <html>.
   Base bg #171310 · surface #1e1a16 · text #ede6dc · accent #d4845a        */
.dark {
  --bg:           #171310;
  --workspace:    #1e1a16;
  --surface:      #1e1a16;
  --surface-2:    #252018;
  --surface-3:    #2e2820;
  --border:       #38322a;
  --border-subtle:#2a2520;
  --text:         #ede6dc;
  --text-muted:   #a89880;
  --text-subtle:  #8a7a68;
  --primary:      #d4845a;
  --primary-weak: #2e1e14;
  --accent:       #d4845a;
  --accent-weak:  #2e1e14;
  --success:      #6db97a;
  --error:        #e07070;
}

@layer base {
  html,
  body {
    height: 100%;
    overflow: hidden;
    margin: 0;
    font-family: var(--font-sans);
    background-color: var(--bg);
    color: var(--text-subtle);
    font-size: var(--fs-base);
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    transition: background-color var(--motion-enter) var(--ease),
      color var(--motion-enter) var(--ease);
  }

  @media (prefers-reduced-motion: reduce) {
    html, body { scroll-behavior: auto; }
    /* Kill the theme-switch colour transition on the root elements */
    html, body { transition: none !important; }
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-heading);
    color: var(--text);
    font-weight: 400;        /* Instrument Serif reads better at regular weight */
    line-height: 1.2;
    letter-spacing: -0.01em;
  }

  h1 { font-size: clamp(1.75rem, 4vw, 2.5rem); }
  h2 { font-size: clamp(1.25rem, 2.5vw, 1.75rem); }
  h3 { font-size: 1.25rem; }

  code, kbd, samp, pre {
    font-family: var(--font-mono);
    font-size: 0.875em;
  }

  /* ── Global :focus-visible ─────────────────────────────────────────────
     High-contrast ring visible on both dark and light themes.
     Offset colour matches the panel bg so the ring "floats".               */
  :focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 3px;
    border-radius: 4px;
  }

  /* Suppress the default outline only when :focus-visible is supported,
     so keyboard users always see something.                                */
  :focus:not(:focus-visible) {
    outline: none;
  }
}

@layer components {
  /* Resume card */
  .resume-card {
    display: block;
    width: 100%;
    text-align: left;
    padding: 1rem;
    color: inherit;
    background-color: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    box-shadow: none;
    cursor: default;
    transition: box-shadow 180ms var(--ease),
      opacity var(--motion-enter) var(--ease),
      transform var(--motion-press) var(--ease);
  }
  .resume-card:hover {
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.06);
  }
  .resume-card:focus {
    outline: none;
  }
  .resume-card:focus-visible {
    box-shadow: 0 0 0 2px var(--bg), 0 0 0 4px var(--primary);
  }
  .resume-card--highlight {
    animation: card-highlight-glow 1.2s var(--ease) forwards;
  }
  @media (prefers-reduced-motion: reduce) {
    .resume-card--highlight {
      animation-duration: 0.01ms;
    }
    .resume-card:hover {
      transition: none;
    }
  }

  @keyframes card-highlight-glow {
    0% {
      box-shadow: 0 0 0 2px var(--accent);
    }
    100% {
      box-shadow: none;
    }
  }

  /* Tag chips inside resume cards */
  .resume-card-tag {
    display: inline-flex;
    align-items: center;
    padding: 0.125rem 0.5rem;
    font-size: 0.6875rem;
    line-height: 1.3;
    color: var(--text-muted);
    background-color: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
  }

  /* Suggestion / question chips */
  .suggestion-chip {
    display: inline-flex;
    align-items: center;
    padding: var(--space-1) var(--space-6);
    font-size: var(--fs-sm);
    line-height: 1.4;
    color: var(--text);
    background-color: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-pill);
    cursor: pointer;
    transition: background-color 120ms var(--ease),
      border-color 120ms var(--ease),
      transform var(--motion-press) var(--ease);
  }
  .suggestion-chip:hover {
    background-color: var(--primary-weak);
  }
  .suggestion-chip:active {
    transform: translateY(1px);
  }
  .suggestion-chip:focus {
    outline: none;
  }
  .suggestion-chip:focus-visible {
    box-shadow: 0 0 0 2px var(--bg), 0 0 0 4px var(--primary);
  }

  /* Chat bubbles */
  .chat-bubble {
    border-radius: var(--radius-lg);
    transition: opacity var(--motion-enter) var(--ease-decel),
      transform var(--motion-enter) var(--ease-decel);
  }
  .chat-bubble--assistant {
    max-width: min(100%, 65ch);
    padding: var(--space-4) 1.25rem;
    background-color: var(--surface);
    border: 1px solid var(--border);
    box-shadow: 0 1px 3px rgb(0 0 0 / 0.04);
  }
  .chat-bubble--assistant .chat-bubble__content {
    color: var(--text-subtle);
    line-height: 1.55;
  }
  .chat-bubble--assistant .chat-bubble__content ul {
    margin-top: 0.5rem;
    padding-left: 0.25rem;
    list-style-position: outside;
  }
  .chat-bubble--assistant .chat-bubble__content li {
    margin-top: 0.35rem;
  }
  .chat-bubble--user {
    max-width: min(70%, 28rem);
    padding: 0.75rem 1.25rem;
    background-color: var(--primary);
    color: var(--surface);
    border: none;
  }

  /* Citation chips */
  .citation-chip {
    display: inline-flex;
    align-items: center;
    min-height: 1.75rem;
    padding: var(--space-1) var(--space-2);
    font-size: var(--fs-xs);
    line-height: 1.35;
    color: var(--text-subtle);
    background-color: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: background-color 120ms var(--ease),
      color 120ms var(--ease),
      transform var(--motion-press) var(--ease);
  }
  .citation-chip:hover {
    background-color: var(--primary-weak);
    color: var(--text);
  }
  .citation-chip:active {
    transform: translateY(1px);
  }
  .citation-chip:focus {
    outline: none;
  }
  .citation-chip:focus-visible {
    box-shadow: 0 0 0 2px var(--bg), 0 0 0 4px var(--primary);
  }

  /* Pipeline capsule */
  .pipeline-capsule {
    border-radius: var(--radius-md);
    border: 1px solid var(--border);
    background-color: var(--surface-2);
  }

  /* Internal scroll regions (sidebar search list, message list, etc.) */
  .scroll-pane {
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
  .scroll-pane::-webkit-scrollbar { width: 6px; }
  .scroll-pane::-webkit-scrollbar-track { background: transparent; }
  .scroll-pane::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: var(--radius-pill);
  }
  .scroll-pane::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

  /* Top-level panel scroll — center and right columns.
     Visible scrollbar (never overlay) so layout doesn't shift.            */
  .panel-scroll {
    overflow-y: auto;
    overflow-x: hidden;
    overscroll-behavior: contain;
    /* Firefox */
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }
  .panel-scroll::-webkit-scrollbar { width: 6px; }
  .panel-scroll::-webkit-scrollbar-track { background: transparent; }
  .panel-scroll::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: var(--radius-pill);
  }
  .panel-scroll::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
}

@layer utilities {
  /* Font family shortcuts */
  .font-heading { font-family: var(--font-heading); }
  .font-body    { font-family: var(--font-sans); }
  .font-mono    { font-family: var(--font-mono); }

  /* Focus ring (for components that suppress the global :focus-visible) */
  .focus-ring {
    @apply focus:outline-none;
  }
  .focus-ring:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 3px;
  }

  .transition-default {
    transition-duration: var(--motion-enter);
    transition-timing-function: var(--ease);
    transition-property: opacity, transform, color, background-color, border-color;
  }
}

/* ─── Chat thinking-pulse animation ──────────────────────────────────────── */
@keyframes thinking-pulse {
  0%, 80%, 100% { opacity: 0.25; transform: scale(0.8); }
  40%           { opacity: 1;    transform: scale(1);   }
}

@media (prefers-reduced-motion: reduce) {
  @keyframes thinking-pulse {
    0%, 100% { opacity: 0.6; }
    50%      { opacity: 1;   }
  }
}

/* ─── Chat modal: prevent body scroll while open ─────────────────────────── */
body.chat-modal-open {
  overflow: hidden;
}

/* ─── REQ-CPI-1: project card citation-pulse glow (2 s) ─────────────────── */
@keyframes project-card-pulse {
  0%   { box-shadow: 0 0 0 0   color-mix(in srgb, var(--accent) 60%, transparent),
                    0 1px 4px rgb(0 0 0 / 0.06); }
  25%  { box-shadow: 0 0 0 4px color-mix(in srgb, var(--accent) 50%, transparent),
                    0 4px 20px  color-mix(in srgb, var(--accent) 25%, transparent); }
  60%  { box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 35%, transparent),
                    0 2px 12px  color-mix(in srgb, var(--accent) 15%, transparent); }
  100% { box-shadow: 0 0 0 0   color-mix(in srgb, var(--accent) 0%,  transparent),
                    0 1px 4px rgb(0 0 0 / 0.06); }
}

.project-card-pulse {
  animation: project-card-pulse 2s var(--ease) forwards;
}

@media (prefers-reduced-motion: reduce) {
  .project-card-pulse {
    /* Reduced-motion: simple solid ring, no animation */
    animation: none;
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }
}
